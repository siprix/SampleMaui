<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:system="clr-namespace:System;assembly=netstandard"
             xmlns:local="clr-namespace:SampleMaui"
             x:Class="SampleMaui.Pages.MessagesPage">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <CollectionView Margin="2" x:Name="lbMessages" Grid.ColumnSpan="2"
             ItemsSource="{Binding Path=Collection}" SelectionMode="Single">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="1" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <BoxView HeightRequest="1" Color="LightGray" Grid.Row="0" Grid.ColumnSpan="2" VerticalOptions="End" Margin="5,0"/>

                        <ActivityIndicator Scale="0.5" IsRunning="True" Grid.Column="0" Margin="0" IsVisible="{Binding IsWaiting}"/>

                        <Label Grid.Column="0" FontSize="22" Margin="5" VerticalOptions="Center" 
                             Text="{Binding IsIncoming, Converter={StaticResource CallDirectionIconConverter}, Mode=OneWay}"  
                             FontFamily="MaterialIconsRegular" TextColor="Green" />

                        <Label Text="{x:Static local:Icons.check_circle}"  Grid.Column="0" 
                             IsVisible="{Binding IsIncoming, Converter={StaticResource InvBoolToVis}, Mode=OneWay}"
                             TextColor="{Binding SentSuccess, Converter={StaticResource MessageSentColorConverter}, Mode=OneWay}" 
                             FontFamily="MaterialIconsRegular" FontSize="12" FontAttributes="Bold"
                             Margin="2" VerticalOptions="End" HorizontalOptions="End"  />

                        <Label Grid.Column="1" VerticalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Body}" FontAttributes="Bold"/>
                                    <Span Text="{x:Static system:Environment.NewLine}"/>
                                    <Span Text="From: " FontAttributes="Italic" TextColor="Gray"/>
                                    <Span Text="{Binding From, Mode=OneWay}" FontAttributes="Italic" TextColor="Gray"/>
                                    <Span Text=" To: " FontAttributes="Italic" TextColor="Gray"/>
                                    <Span Text="{Binding To, Mode=OneWay}" FontAttributes="Italic" TextColor="Gray"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>

                        <HorizontalStackLayout Grid.Column="1" Grid.ColumnSpan="3" HorizontalOptions="End">
                            <HorizontalStackLayout IsVisible="False">
                                <Button Text="{x:Static local:Icons.delete}" Style="{StaticResource MenuItemButton}"
                                    Clicked="MessageDelete_Click" />
                            </HorizontalStackLayout>

                            <Button Style="{StaticResource MenuButton}" Clicked="ButtonMenu_Click"/>
                        </HorizontalStackLayout>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Picker x:Name="cbMsgAccounts" Grid.Row="1" Margin="5,2" 
            ItemsSource="{Binding Path=Collection}"  ItemDisplayBinding="{Binding Uri}"
            SelectedItem="{Binding Path=SelectedAccount, Mode=OneWay}" />

        <Entry x:Name="txMsgDestExt" Grid.Row="1" Grid.Column="2" Margin="5,2"
            Placeholder="Extension" FontAttributes="Bold"/>

        <Entry x:Name="txMsgBody"  Grid.Row="2" Grid.ColumnSpan="2" Margin="5,2,60,5" 
            Placeholder="Text to send" ClearButtonVisibility="WhileEditing"/>

        <Button Text="{x:Static local:Icons.send}" FontFamily="MaterialIconsRegular" FontSize="22" 
            Grid.Column="1" Grid.Row="2" HorizontalOptions="End" Margin="5,2" Padding="0" 
            Clicked="MessageSend_Click" />
    </Grid>
</ContentPage>